<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Tom</title>
    <!-- Carrega o Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo customizado para a fonte e o corpo */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>

<div class="p-8 max-w-lg w-full bg-white rounded-xl shadow-2xl transition duration-300 hover:shadow-xl">
    <h1 class="text-3xl font-extrabold text-gray-900 mb-4 text-center">Teste de Áudio Garantido</h1>
    <p class="text-gray-600 mb-8 text-center">
        Clique no botão abaixo para gerar um tom simples de 440 Hz (Lá). O som só pode ser ativado após uma interação do usuário.
    </p>

    <!-- Botão de Ação -->
    <button id="playButton"
            class="w-full py-3 px-6 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-150 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
        TOCAR SOM
    </button>

    <!-- Feedback Message -->
    <div id="messageBox" class="mt-6 text-center text-sm text-gray-500 hidden">
        Som tocado com sucesso!
    </div>
    <div id="errorBox" class="mt-6 text-center text-sm text-red-600 hidden">
        Erro ao tocar o som. Verifique o console.
    </div>
</div>

<script>
    // Global variable for AudioContext
    let audioContext = null;

    /**
     * Converts base64 to ArrayBuffer (required for playing PCM audio,
     * though not strictly needed here as we are synthesizing sound directly).
     * Included as a utility function template.
     * @param {string} base64 - Base64 string of the audio data.
     * @returns {ArrayBuffer}
     */
    function base64ToArrayBuffer(base64) {
        // This function is often required when using the Gemini TTS API,
        // but since we are synthesizing sound with the OscillatorNode, it's not used.
        // Keeping it as a reference for complex audio tasks.
        const binaryString = window.atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    }

    /**
     * Plays a simple 440Hz tone using the Web Audio API Oscillator.
     */
    function playSound() {
        const messageBox = document.getElementById('messageBox');
        const errorBox = document.getElementById('errorBox');
        messageBox.classList.add('hidden');
        errorBox.classList.add('hidden');

        try {
            // 1. Initialize AudioContext (must be done on user action)
            if (audioContext === null) {
                // Check for browser compatibility and create the context
                const AudioContextClass = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContextClass();
            }

            // Ensure the context is running (especially important for mobile browsers)
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            // 2. Create an OscillatorNode (the sound source)
            const oscillator = audioContext.createOscillator();

            // 3. Set the frequency (A4 note - 440 Hz)
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);

            // 4. Set the type of waveform (e.g., sine, square, sawtooth, triangle)
            oscillator.type = 'sine';

            // 5. Create a GainNode (volume control)
            const gainNode = audioContext.createGain();
            // Start at max volume
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);

            // 6. Connect the nodes: Oscillator -> Gain -> Destination (speakers)
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // 7. Start the oscillator immediately
            oscillator.start();

            // 8. Schedule the sound to stop after 0.5 seconds and fade out
            const duration = 0.5; // seconds
            const now = audioContext.currentTime;

            // Fade out the gain a little before stopping
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);

            // Stop the oscillator completely after the fade
            oscillator.stop(now + duration + 0.1);

            // Show success message
            messageBox.classList.remove('hidden');

        } catch (error) {
            console.error("Failed to play sound:", error);
            errorBox.textContent = `Erro ao tocar o som: ${error.message}.`;
            errorBox.classList.remove('hidden');
        }
    }

    // Attach the function to the button click event after the window loads
    window.onload = function() {
        document.getElementById('playButton').addEventListener('click', playSound);
    };
</script>
</body>
</html>
